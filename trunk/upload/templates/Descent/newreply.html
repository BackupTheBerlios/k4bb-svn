<core:import id="forum_rules" file="forum_rules.html" />
<core:import id="preview" />
<form:form name="savepost_form" id="savepost_form" action="{$newreply_act}" method="post" enctype="multipart/form-data">
<input type="hidden" name="forum_id" id="forum_id" value="{$post_forum_id}" />
<input type="hidden" name="post_id" id="post_id" value="{$post_post_id}" />
<input type="hidden" name="topic_id" id="topic_id" value="{$topic_id}" />
<core:block id="parent_id" hidden="yes"><input type="hidden" name="parent_id" id="parent_id" value="{$parent_id}" /></core:block>

<!-- AJAX Reply Preview -->
<div id="ajax_post_preview" style="display: none;"></div>
<!-- / AJAX Reply Preview -->

<div class="spacer">
	<div class="borderwrap">
		<div class="maintitle">
			<core:block id="post_reply">
			<div style="float:right;" class="smalltext">
				<strong>{$L_REPLY}:</strong>
				<a href="findpost.php?id={$parent_id}" class="smalltext" style="font-weight: normal;" title="{$parent_name}">{$parent_name}</a>
			</div>
			{$L_POSTREPLY}
			</core:block>
			<core:block id="edit_post" hidden="yes">
			<div style="float:right;" class="smalltext">
				<strong>{$L_REPLY}:</strong>
				<a href="findpost.php?id={$post_post_id}" class="smalltext" style="font-weight: normal;" title="{$post_name}">{$post_name}</a>
			</div>
			{$L_EDITPOST}: <span style="font-weight: normal;">{$post_name}</span>
			</core:block>
		</div>
		<table width="100%" cellspacing="{$style_cellspacing}" class="table">
			<tr>
				<td class="alt3" colspan="2" align="center">
					
					<!-- Main Posting Inputs -->
					<div class="outset_box" align="left">
						<span class="smalltext" style="float: right;">
							{$L_LOGGEDAS}
							<is:logged>
							<a href="member.php?id={$user_id}" style="text-decoration: underline;">{$user_name}</a>
							<if:else />
							<strong>{$L_GUEST}</strong>
							</is:logged>
						</span>
						<table border="0" cellspacing="0">
							<is:unlogged>
							<tr>
								<td>
									<!-- Poster Name -->
									<label for="poster_name" class="smalltext">{$L_YOURNAME}</label><br />
									<input type="text" name="poster_name" id="poster_name" tabindex="1" value="{$poster_name}" size="{$maxuserlength}" class="inputbox" maxlength="{$maxuserlength}" />
									<!-- / Poster Name -->
								</td>
							</tr>
							</is:unlogged>
							<tr>
								<td>
									<!-- Post Title -->
									<label for="name" class="smalltext">{$L_POSTTITLE}</label><br />
									<input type="text" name="name" id="name" value="{$post_name}" tabindex="2" style="width: 500px;" class="inputbox" maxlength="255" />
									<form:error id="name_error" for="name" setclass="inputfailed" regex=".{{$topicminchars},{$topicmaxchars}}">{$L_TITLETOOSHORT}</form:error>
									<!-- / Post Title -->
								</td>
								<td valign="bottom">
									<img id="display_posticon" src="tmp/upload/posticons/clear.gif" alt="" />
								</td>
							</tr>
							<tr>
								<td>
									<br />
									<!-- Post Message -->
									<label for="messagecodex" class="smalltext">{$L_POST}</label><br />
									
									<core:import id="editor" file="editor.html" />
									<form:error id="messagecodex_error" for="messagecodex" setclass="inputfailed" regex="(\n|\r\n|\r|.)+">{$L_INSERTREPLYMESSAGE}</form:error>
									
									<!-- / Post Message -->

								</td>
								<td valign="bottom">
									<maps:if forum="forum_forum_id" var="emoticons" method="can_add">
									<list:list id="emoticons">
									
									<!-- Emoticons -->
									<table border="0" cellspacing="0">
										<tr>
											<td>
												<fieldset>
													<legend>{$L_EMOTICONS}</legend>
													<table cellpadding="3" cellspacing="{$style_cellspacing}" id="posticons">
														<tr>
															<list:item list="emoticons">
															<td align="center">
																<a href="javascript:emoticon('{$typed}')" title="{$description}"><img src="tmp/upload/emoticons/{$image}" alt="{$description}" border="0" /></a>
															</td>
															<list:separator list="emoticons">
																<list:alternate list="emoticons" count="{@emoticons_per_row}" remainder="{@emoticons_per_row_remainder}">
																	</tr><tr>
																</list:alternate>
															</list:separator>
															</list:item>
														</tr>	
													</table>
												</fieldset>
											</td>
										</tr>
									</table>
									<!-- / Emoticons -->

									</list:list>
									</maps:if>
								</td>
							</tr>
							<maps:if forum="forum_forum_id" var="posticons" method="can_add">
							<tr>
								<td colspan="2">
									<list:list id="posticons">
									
									<!-- Post Icons -->
									<table border="0" cellspacing="0" width="100%">
										<tr>
											<td>
												<fieldset>
													<legend>{$L_POSTICONS}</legend>
													<span class="smalltext">{$L_POSTICONSPOSTCHOOSE}</span>
													<label for="noicon" style="float: left;margin-top: 10px;"><input type="radio" name="posticon" id="noicon" value="clear.gif" checked="checked" onclick="swap_posticon(null)" />&nbsp;{$L_NOICON}</label>
													<table cellpadding="3" cellspacing="{$style_cellspacing}" id="posticons">
														<tr>
															<list:item list="posticons">
															<td align="center">
																<label for="pi{$id}">
																	<input type="radio" name="posticon" id="pi{$id}" value="{$image}" style="float: left;padding-right: 5px;" onclick="swap_posticon('pi_{$id}')" />&nbsp;&nbsp;<img src="tmp/upload/posticons/{$image}" alt="{$description}" id="pi_{$id}" style="margin-right:15px;" />
																</label>
															</td>
															<list:separator list="posticons">
																<list:alternate list="posticons" count="7" remainder="6">
																	</tr><tr>
																</list:alternate>
															</list:separator>
															</list:item>
														</tr>	
													</table>
												</fieldset>
											</td>
										</tr>
									</table>
									<!-- / Post Icons -->

									</list:list>
								</td>
							</tr>
							</maps:if>
						</table>
					</div>
					<!-- / Main Posting Inputs -->

				</td>
			</tr>
			<tr>
				<td class="subtitle" align="center" colspan="2">
					<input type="hidden" name="submit_type" id="submit_type" value="" />
					<input <if:if var="nojs" eq="1">name="post"</if:if> type="submit" class="button" value="{$L_SUBMIT}" accesskey="s" onclick="try{set_message_text();}catch(e){}if(checkForm(d.getElementById('savepost_form'))) { change_submit_type('submit_type', 'post'); }" />
					<maps:if forum="forum_forum_id" var="post_preview" method="can_add">
						<input type="<if:if var="nojs" eq="0">button<if:else />submit</if:if>" <if:if var="nojs" eq="1">name="preview"</if:if>class="button" value="{$L_PREVIEW}" onclick="try{set_message_text();}catch(e){}if(checkForm(d.getElementById('savepost_form'))) { change_submit_type('submit_type', 'preview');setSendPostPreview('{$newreply_act}'); }" />
					</maps:if>
					<input type="reset" class="button" value="{$L_RESET}" />
				</td>
			</tr>
		</table>
	</div>
</div>
<br />

<!-- Additional Post Options -->
<div class="spacer">
	<div class="borderwrap">
		<div class="maintitle" id="po_maintitle">
			<if:if var="nojs" eq="0"><div style="float: right;"><a href="javascript:;" onclick="return collapse_tbody('collapse_po', 'postoptions', 'po_maintitle')" title="{$L_EXPANDCOLLAPSE}"><img id="collapse_po" src="Images/{$IMG_DIR}/Icons/collapse_thead_collapsed.gif" alt="{$L_EXPANDCOLLAPSE}" border="0" /></a></div></if:if>
			{$L_ADDITIONALOPTIONS}
		</div>
		<table width="100%" cellspacing="{$style_cellspacing}" class="table" id="postoptions" <if:if var="nojs" eq="0">style="display: none;"</if:if>>
			<tr>
				<td class="alt3">
					<div class="outset_box">
						<fieldset>
							<legend>{$L_MISCOPTIONS}</legend>
							<maps:if forum="forum_forum_id" var="html" method="can_add"><input type="checkbox" name="disable_html" id="disable_html" checked="checked" />&nbsp;<label for="disable_html">{$L_DISABLEHTML}</label><br /></maps:if>
							<!--<input type="checkbox" name="disable_bbcode" id="disable_bbcode" />&nbsp;<label for="disable_bbcode">{$L_DISABLEBBCODE}</label><br />-->
							<input type="checkbox" name="disable_emoticons" id="disable_emoticons" />&nbsp;<label for="disable_emoticons">{$L_DISABLEEMOTICONS}</label><br />
							<input type="checkbox" name="disable_aurls" id="disable_aurls" />&nbsp;<label for="disable_aurls">{$L_PARSEURLS}</label><br />
							<is:logged><input type="checkbox" name="enable_sig" id="enable_sig" checked="checked" />&nbsp;<label for="enable_sig">{$L_ATTACHSIGNATURE}</label><br />
							<input type="checkbox" name="disable_areply" id="disable_areply" />&nbsp;<label for="disable_areply">{$L_NOTIFYONREPLY}</label></is:logged>
						</fieldset>
					</div>
				</td>
			</tr>
		</table>
	</div>
</div>
<!-- / Additional Post Options -->

<maps:if var="attachments" method="can_add" forum="forum_forum_id">
<br />
<!-- Attachments Manager -->
<div class="spacer">
	<div class="borderwrap">
		<div class="maintitle" id="am_maintitle">
			<if:if var="nojs" eq="0"><div style="float: right;"><a href="javascript:;" onclick="return collapse_tbody('collapse_am', 'attachmanage', 'am_maintitle')" title="{$L_EXPANDCOLLAPSE}"><img id="collapse_am" src="Images/{$IMG_DIR}/Icons/collapse_thead_collapsed.gif" alt="{$L_EXPANDCOLLAPSE}" border="0" /></a></div></if:if>
			{$L_ATTACHMENTSMANAGER}
		</div>
		<table width="100%" cellspacing="{$style_cellspacing}" class="table" id="attachmanage" <if:if var="nojs" eq="0">style="display: none;"</if:if>>
			<tr>
				<td class="alt3">
					<div class="outset_box">
						<fieldset>
							<legend>{$L_SELECTFILES}</legend>
							<div class="smalltext">{$L_VALIDEXTENSIONS}: {$attachextensions}</div>
							<input type="hidden" name="MAX_FILE_SIZE" value="{$maxattachsize}" />
							{$attach_inputs}
						</fieldset>
					</div>
				</td>
			</tr>
		</table>
	</div>
</div>
<!-- / Attachments Manager -->
</maps:if>

</form:form>
<br />

<!-- Topic Review -->
<div class="spacer">
	<div class="borderwrap">
		<div class="maintitle" id="tr_maintitle">
			<if:if var="nojs" eq="0"><div style="float: right;"><a href="javascript:;" onclick="return collapse_tbody('topicreview_link', 'topicreview', 'tr_maintitle')" title="{$L_EXPANDCOLLAPSE}"><img id="topicreview_link" src="Images/{$IMG_DIR}/Icons/collapse_thead.gif" alt="{$L_EXPANDCOLLAPSE}" border="0" /></a></div></if:if>
			{$L_TOPICREVIEW} - {$post_name}
		</div>
		<div class="alt3" style="padding: 0px;">
			<div style="height: 300px; overflow: auto;" id="topicreview">
				<list:list id="topic_review">
				<table width="99%" cellspacing="{$style_cellspacing}" class="table">
				<tr>
					<td class="subtitle" width="20%"><div align="center">{$L_AUTHOR}</div></td>
					<td class="subtitle" width="80%"><div align="center">{$L_MESSAGE}</div></td>
				</tr>
				<list:item list="topic_review">

				<maps:if var="replies" forum="forum_forum_id" method="can_view">
				<list:sublist list="topic_review" id="replies" column="replies">
				<list:item list="replies">

				<!-- Reply: {$name} -->
				<core:import id="reply" file="post_review.html" />
				<!-- / Reply: {$name} -->

				</list:item>
				</list:sublist>
				</maps:if>
				
				<!-- Topic: {$name} -->
				<core:import id="topic" file="post_review.html" />
				<!-- / Topic: {$name} -->

				</list:item>
				</table>
				</list:list>
			</div>
		</div>
	</div>
</div>
<!-- / Topic Review -->

<br />
<!-- Posting Code Allowances -->
<div class="spacer">
	<div class="borderwrap">
		<div class="maintitle" id="pr_maintitle">
			<div style="float: right;"><a href="javascript:;" onclick="return collapse_tbody('collapse_pr', 'postingrules', 'pr_maintitle')" title="{$L_EXPANDCOLLAPSE}"><img id="collapse_pr" src="Images/{$IMG_DIR}/Icons/collapse_thead.gif" alt="{$L_EXPANDCOLLAPSE}" border="0" /></a></div>
			{$L_POSTINGRULES}
		</div>
		<table width="100%" cellspacing="{$style_cellspacing}" class="table" id="postingrules">
			<tr>
				<td class="alt3" valign="top">
					<div align="left" class="minitext">
						{$posting_code_options}
					</div>
				</td>
				<td class="alt3" valign="top">
					<div align="right" class="minitext">
						<table cellspacing="0">
							<tr>
								<td valign="top">
									{$forum_user_reply_options}
								</td>
							</tr>
						</table>
					</div>
				</td>
			</tr>
		</table>
	</div>
</div>
<!-- / Posting Code Allowances -->

<core:block id="edit_reply" hidden="yes">
<!-- Edit Reply Javascript -->
<script type="text/javascript">
//<![CDATA[

	/**
	 * Get the main posting options
	 */
	
	try {
		<maps:if forum="forum_forum_id" var="html" method="can_add">var disable_html			= document.getElementById('disable_html');</maps:if>
		//var disable_bbcode			= d.getElementById('disable_bbcode');
		var disable_emoticons		= d.getElementById('disable_emoticons');
		var disable_aurls			= d.getElementById('disable_aurls');
		var enable_sig				= d.getElementById('enable_sig');
		var disable_areply			= d.getElementById('disable_areply');
		
		<maps:if forum="forum_forum_id" var="html" method="can_add">disable_html.checked		= ({$post_disable_html} == 1) ? true : false;</maps:if>
		//disable_bbcode.checked		= ({$post_disable_bbcode} == 1) ? true : false;
		disable_emoticons.checked	= ({$post_disable_emoticons} == 1) ? true : false;
		disable_aurls.checked		= ({$post_disable_aurls} == 1) ? true : false;
		enable_sig.checked			= ({$post_disable_sig} == 1) ? false : true;
		disable_areply.checked		= ({$post_disable_areply} == 1) ? true : false;
	
	} catch(e) {
		alert(e.message);
	}


	/**
	 * Get the post icons
	 */
	d.setRadio('{$post_posticon}', 'posticon');

	var pi_image	= d.getElementById('display_posticon');
	pi_image.src	= 'tmp/upload/posticons/{$post_posticon}';

//]]>
</script>
<!-- / Edit Reply Javascript -->
</core:block>